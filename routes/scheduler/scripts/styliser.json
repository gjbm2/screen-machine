{
  "final_actions": {
    "instructions_block": [
      {
        "action": "log",
        "message": "Styliser session complete - 20 minutes of stylistic exploration finished"
      },
      {
        "action": "wait",
        "duration": "1m"
      },
      {
        "action": "log",
        "message": "Restoring original image: {{ original_image }}"
      },
      {
        "action": "publish",
        "source": "{{ original_image }}",
        "silent": true
      },
      {
        "action": "log",
        "message": "Original image restored - system returned to ex ante state"
      }
    ]
  },
  "initial_actions": {
    "instructions_block": [
      {
        "action": "log",
        "message": "** Starting Styliser Session **"
      },
      {
        "action": "set_var",
        "var": "original_image",
        "input": {
          "value": "{{ _current_image }}"
        }
      },
      {
        "action": "log",
        "message": "Stored original image for restoration: {{ original_image }}"
      },
      {
        "action": "overlay",
        "text": "Stylising will begin in 2 minutes using the image currently displayed. You have time to create or upload a different image.<br><br><div style=\"display: flex; justify-content: center; margin: 20px 0;\"><img src=\"{{ QR_BASE64 }}\" style=\"width: 200px; height: auto; border-radius: 16px; opacity: 0.9; box-shadow: 0 4px 12px rgba(0,0,0,0.15);\" /></div><br>Scan the QR code to upload a new image to this screen, or we'll go with the one we have.",
        "duration": "2m"
      },
      {
        "action": "throw_event",
        "scope": "current",
        "event": "get_started",
        "delay": "2m"
      },
      {
        "action": "set_var",
        "var": "style_history",
        "input": {
          "value": []
        }
      },
      {
        "action": "set_var",
        "var": "session_countwhere ",
        "input": {
          "value": 0
        }
      }
    ]
  },
  "triggers": [
    {
      "type": "event",
      "value": "get_started",
      "trigger_actions": {
        "instructions_block": [
          {
            "action": "log",
            "message": "** Starting Styliser Process **"
          },
          {
            "action": "set_var",
            "var": "working_image",
            "input": {
              "value": "{{ _current_image }}"
            }
          },
          {
            "action": "log",
            "message": "Captured working image for all generations: {{ working_image }}"
          },
          {
            "action": "throw_event",
            "scope": "current",
            "event": "styliser_start"
          }
        ],
        "important": true
      }
    },
    {
      "type": "event",
      "value": "styliser_start",
      "trigger_actions": {
        "instructions_block": [
          {
            "action": "set_var",
            "var": "session_count",
            "input": {
              "value": "{{ session_count + 1 }}"
            }
          },
          {
            "action": "set_var",
            "var": "source_image",
            "input": {
              "value": "{{ working_image }}"
            }
          },
          {
            "action": "reason",
            "text_input": "Analyze this image and create a detailed artistic style transformation prompt. Choose from diverse visual art styles like: Impressionism (soft, dreamy brushstrokes with light effects), Cubism (geometric shapes and fragmented perspectives), Art Nouveau (flowing organic lines and decorative elements), Pop Art (bold colors and commercial imagery), Surrealism (dreamlike and fantastical elements), Abstract Expressionism (bold colors and gestural brushwork), Minimalism (clean lines and simple forms), Baroque (dramatic lighting and rich details), Art Deco (geometric patterns and luxurious elements), Fauvism (wild, non-naturalistic colors), Pointillism (composed of small dots of color), Gothic (dark, mysterious atmosphere), Renaissance (classical proportions and techniques), Watercolor (translucent, flowing effects), Oil Painting (rich textures and blended colors), Pencil Sketch (detailed line work), Digital Art (modern computer-generated effects), Street Art/Graffiti (urban, expressive style), Vintage Photography (sepia tones, aged effects), or Anime/Manga (stylized Japanese animation style). Be creative and specific about colors, textures, lighting, and artistic techniques. Avoid these recent styles: {{ style_history[-5:] | map(attribute='outputs.style_prompt') | list if style_history else [] }}. Return only the artistic style transformation prompt that can be used directly for image generation.",
            "reasoner": "adapt",
            "output_vars": [
              "style_prompt"
            ],
            "image_inputs": [
              "{{ source_image }}"
            ]
          },
          {
            "action": "generate",
            "images": [
              "{{ source_image }}"
            ],
            "input": {
              "prompt": "{{ style_prompt }}"
            },
            "workflow": "flux_1_kontext_dev_1pic-l.json",
            "publish": true,
            "refiner": "adapt",
            "output_var": "styled_image",
            "history_var": "style_history"
          },
          {
            "action": "log",
            "message": "Applied style transformation - iteration {{ session_count }} complete"
          },
          {
            "action": "terminate",
            "mode": "normal",
            "test": "{{ session_count >= 12 }}"
          },
          {
            "action": "throw_event",
            "scope": "current",
            "event": "styliser_start"
          }
        ],
        "important": true
      }
    }
  ]
} 